@model UserAccountViewModel
@{
    var parent = (WebViewPage)TempData["Parent"];
}

@foreach (var cred in Model.CredentialGroups[CredentialKind.External])
{
    @ViewHelpers.Section(parent,
        "change-credential-" + cred.Key,
        @<text>Login Account</text>,
        @<text>@cred.TypeCaption (@cred.Identity) | 
            @if (!Model.EnableMultiFactorAuthentication)
            {
                <span>
                    <i class="ms-Icon ms-Icon--Warning warning-icon" title="2FA is disabled. Please enable 2FA for secure login." aria-hidden="true"></i> 2FA disabled
                </span>
            }
            else
            {
                <span>
                    <i class="ms-Icon ms-Icon--CheckMark checkmark-icon" title="2FA is enabled." aria-hidden="true"></i> 2FA enabled
                </span>
            }
        </text>,
        @<text>
            @using (Html.BeginForm("LinkOrChangeExternalCredential", "Users"))
            {
                @Html.AntiForgeryToken()

                <div class="login-account-row">
                    <span>
                        Linked Microsoft account: <b>@cred.Identity</b>
                    </span>
                    <span class="col-sm-3">
                        <button class="btn btn-default btn-block" type="submit"
                                data-confirm="This action will replace all of your linked accounts and password login with the new login account. Are you sure you want to change your login account?">
                            Change Account
                        </button>
                    </span>
                </div>
            }
            @using (Html.BeginForm("ChangeMultiFactorAuthentication", "Users", FormMethod.Post))
            {
                @Html.AntiForgeryToken()

                @Html.Hidden("enableMultiFactor", !Model.EnableMultiFactorAuthentication);
                @Html.Hidden("accountName", Model.AccountName);

                <div class="login-account-row">
                    @if (!Model.EnableMultiFactorAuthentication)
                    {
                            <span>
                                Two-factor authentication is currently disabled <i class="ms-Icon ms-Icon--Warning warning-icon" aria-hidden="true"></i>
                            </span>
                            <span class="col-sm-3">
                                <button class="btn btn-success btn-block" type="submit">Enable</button>
                            </span>
                    }
                    else
                    {
                            <span>
                                Two-factor authentication is currently enabled <i class="ms-Icon ms-Icon--CheckMark checkmark-icon" aria-hidden="true"></i>
                            </span>
                            <span class="col-sm-3">
                                <button class="btn btn-danger btn-block" type="submit"
                                        data-confirm="This action will disable 2FA making your accounts less secure. Are you sure you want to disable this setting?">
                                    Disable
                                </button>
                            </span>
                    }
                </div>
            }
        </text>)
}