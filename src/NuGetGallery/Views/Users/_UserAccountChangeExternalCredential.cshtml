@model UserAccountViewModel
@{
    var parent = (WebViewPage)TempData["Parent"];
}

@foreach (var cred in Model.CredentialGroups[CredentialKind.External])
{
    @ViewHelpers.Section(parent,
        "change-credential-" + cred.Key,
        @<text>Login Account</text>,
        @<text>@cred.TypeCaption (@cred.Identity) | 
            @if (CredentialTypes.IsMicrosoftAccount(cred.Type))
            {
                if (Model.EnableMultiFactorAuthentication)
                {
                    <span>
                        <i class="ms-Icon ms-Icon--CheckMark checkmark-icon" aria-hidden="true"></i> 2FA enabled
                    </span>
                }
                else
                {
                    <span>
                        <i class="ms-Icon ms-Icon--Warning warning-icon" aria-hidden="true"></i> 2FA disabled
                    </span>                
                }
            }
            else if (CredentialTypes.IsAzureActiveDirectoryAccount(cred.Type))
            {
                if (User.WasMultiFactorAuthenticated())
                {
                    <span>
                        <i class="ms-Icon ms-Icon--CheckMark checkmark-icon" aria-hidden="true"></i> 2FA enabled
                    </span>
                }
                else
                {
                    <span>
                        <i class="ms-Icon ms-Icon--Warning warning-icon" aria-hidden="true"></i> 2FA disabled
                    </span>
                }
            }
        </text>,
        @<text>
            @using (Html.BeginForm("LinkOrChangeExternalCredential", "Users", FormMethod.Post, new { aria_label = "Link or change " + cred.TypeCaption }))
            {
                @Html.AntiForgeryToken()

                <div class="login-account-row">
                    <span>
                        Linked Microsoft account: <b>@cred.Identity</b>
                    </span>
                    <span class="col-sm-3">
                        <button class="btn btn-default btn-block" type="submit"
                                data-confirm="This action will replace all of your linked accounts and password login with the new login account. Are you sure you want to change your login account?">
                            Change Account
                        </button>
                    </span>
                </div>
            }

            @if (CredentialTypes.IsAzureActiveDirectoryAccount(cred.Type))
            {
                <div class="login-account-row">
                    @if (User.WasMultiFactorAuthenticated())
                    {
                        <span>
                            Looks like two-factor authentication is enabled by your Azure Active Directory tenant administrator. <i class="ms-Icon ms-Icon--CheckMark checkmark-icon" aria-hidden="true"></i>
                        </span>
                    }
                    else
                    {
                        <span>
                            Two-factor authentication setting is controlled by your Azure Active Directory tenant administrator. Please ask your administrator to enable the setting for two-factor authentication.
                        </span>
                    }
                </div>
            }
            else
            {
                using (Html.BeginForm("ChangeMultiFactorAuthentication", "Users", FormMethod.Post, new { aria_label = "Change multi-factor authentication setting" }))
                {
                    @Html.AntiForgeryToken()

                    @Html.Hidden("enableMultiFactor", !Model.EnableMultiFactorAuthentication);
                    @Html.Hidden("accountName", Model.AccountName);
                    <div class="login-account-row">
                        @if (!Model.EnableMultiFactorAuthentication)
                        {
                            <span>
                                Two-factor authentication is currently disabled <i class="ms-Icon ms-Icon--Warning warning-icon" aria-hidden="true"></i>
                            </span>
                            <span class="col-sm-3">
                                <button class="btn btn-default btn-block" type="submit">Enable</button>
                            </span>
                        }
                        else
                        {
                            <span>
                                Two-factor authentication is currently enabled <i class="ms-Icon ms-Icon--CheckMark checkmark-icon" aria-hidden="true"></i>
                            </span>
                            <span class="col-sm-3">
                                <button class="btn btn-danger btn-block" type="submit"
                                        data-confirm="This action will disable 2FA making your account less secure. Are you sure you want to disable this setting?">
                                    Disable
                                </button>
                            </span>
                        }
                    </div>
                }
            }
        </text>)
}